<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- <script type="text/javascript" src="/lastfive.js"></script>  why doesn't this script work!!???-->
    <title>Search</title>
</head>

<body class="d-flex flex-column vh-100">
    <div class="container pt-3">
        <div class="container">
            <h1>Find Today's Weather</h1>
            <form action="/search" method="GET">
                <label for="location">Input City</label>
                <input type="text" id="location" name="location">
                <button class="btn btn-primary" id="weatherSearch">Search</button>
            </form>
        </div>
        <% if(data && Object.keys(data).length> 0) {%>
            <div class="container mt-5 p-4 border">
                <h3>
                    <%= data.location %>'s weather right now is <%= data.text %> <img src=<%=data.icon %> alt="Weather
                            data
                            by WeatherAPI.com" border="0">
                </h3>
                <table class="table border">
                    <thead>
                        <tr class="table-success">
                            <th>Temperature (F)</th>
                            <th>Humidity</th>
                            <th>Precipitation</th>
                            <th>Cloud Cover</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <%= data.temp_f %>&#176;
                            </td>
                            <td>
                                <%= data.humidity %>%
                            </td>
                            <td>
                                <%= data.precip_in %> in.
                            </td>
                            <td>
                                <%= data.cloud %>%
                            </td>
                        </tr>
                    </tbody>
                </table>
                <% } %>
            </div>
    </div>
    <script>
        const weatherSearch = document.querySelector('#weatherSearch');
        const locationInput = document.getElementById('location')

        //adding to local storage
        const addLocation = () => {
            const locVal = locationInput.value
            let key = 0
            if (localStorage.length < 5) {
                key = localStorage.length + 1
                localStorage.setItem(key,locVal)
            } else {
                //removes earliest item
                localStorage.removeItem(1)
                //relabel keys
                let keys = Object.keys(localStorage);
                let tempObj = {}
                for (let key of keys) {
                    tempObj[key-1] = localStorage.getItem(key)
                }
                localStorage.clear();
                keys = Object.keys(tempObj);
                let tempVal = ''
                for (let key of keys) {
                    tempVal = tempObj[key];
                    localStorage.setItem(key,tempVal)
                }
                localStorage.setItem(5,locVal);
            }
        }
        weatherSearch.addEventListener('click', addLocation)

        // const testButton = () => {
        //     console.log('clicked!!!')
        //     const locVal = locationInput.value 
        //     console.log(locVal)

        // }

        // weatherSearch.addEventListener('click', testButton)
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
</body>
<footer class="footer bg-secondary py-3 mt-auto">
    <div class="container">
        Powered by <a href="https://www.weatherapi.com/" title="Free Weather API">WeatherAPI.com</a>
        <a href="https://www.weatherapi.com/" title="Free Weather API"><img
                src='//cdn.weatherapi.com/v4/images/weatherapi_logo.png' alt="Weather data by WeatherAPI.com"
                border="0"></a>
    </div>
</footer>

</html>